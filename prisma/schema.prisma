//currently building an internal management software for a kinesitherapy center, the requirements needed are to keep track of appointments, patients, also services they needed on each session, keeping track of payments, also keeping track of expenses and revenue on each week. also providing some monthly reports etc...
//i'using react, nextjs,prisma,postgresql, first let's talk about non technical requirements. the problem and the flow needed if you need any information feel free to ask

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// this model is for management personnels
model User {
    id          String   @id @default(cuid())
    name        String
    email       String   @unique
    image       String   @db.Text
    password    String
    phoneNumber String?  @unique @map("phone_number")
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt @map("updated_at")

    @@map("utilisateurs")
}

// this model is for patients
model Patient {
    id                Int           @id @default(autoincrement())
    firstName         String        @map("first_name")
    lastName          String        @map("last_name")
    email             String?
    dateOfBirth       DateTime?     @map("date_of_birth")
    phoneNumber       String?       @map("phone_number")
    address           String?       @db.Text
    notes             String?       @db.Text
    // medical history: it means the patient's medical history which includes the patient's past and present health issues, surgeries, medications, allergies, and other medical conditions.
    insuranceProvider String?
    createdAt         DateTime      @default(now()) @map("created_at")
    updatedAt         DateTime      @updatedAt @map("updated_at")
    appointments      Appointment[]
    documents         Document[]
    payments          Payment[]

    @@map("patients")
}

model Therapist {
    id         String   @id @default(cuid())
    name       String
    image      String   @db.Text
    speciality String?
    createdAt  DateTime @default(now()) @map("created_at")
    updatedAt  DateTime @updatedAt @map("updated_at")

    @@map("therapists")
}

model Appointment {
    id          String   @id @default(cuid())
    patientId   Int      @map("patient_id")
    therapistId String   @map("therapist_id")
    serviceId   String?  @map("service_id")
    date        DateTime
    duration    Int // in minutes
    status      String // pending, confirmed, cancelled: when the patient cancels the appointment or the therapist cancels the appointment or the appointment is cancelled by the management
    createdAt   DateTime @default(now()) @map("created_at")
    updatedAt   DateTime @updatedAt @map("updated_at")
    // when the appointment is confirmed, the service is added to the appointment
    service     Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)
    patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

    @@map("appointments")
}

model Service {
    id           String        @id @default(cuid())
    name         String
    description  String?
    price        Float?
    duration     Int? // in minutes
    createdAt    DateTime      @default(now()) @map("created_at")
    updatedAt    DateTime      @updatedAt @map("updated_at")
    appointments Appointment[]

    @@map("services")
}

model Document {
    id          String @id @default(cuid())
    patientId   Int    @map("patient_id")
    name        String
    contentType String @map("content_type")
    fileSize    Int    @map("file_size")
    key         String

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")
    patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

    @@map("documents")
}

// Payments model: for this model, we need to keep track of the payments made by the patients, the payments made might not exactly be related to an appointment, it could be for a service or a product, or multiple sessions or paid in advance.
// we also need an enum for the payment label which could be "appointment", "service", "product", "advance", etc...

model Payment {
    id               String   @id @default(cuid())
    patientId        Int      @map("patient_id")
    amount           Float
    description      String?
    label            String
    numberOfSessions Int?     @default(1) @map("number_of_sessions") // if the payment is for multiple sessions
    // the date when the payment was made
    paymentDate      DateTime @map("payment_date")
    // the method used for the payment (e.g., cash, credit card, bank transfer)
    paymentMethod    String?  @map("payment_method")

    isPaid Boolean @default(false) @map("is_paid") // indicates if the payment has been fully paid
    // add any other fields that are relevant to your payment system
    notes  String? @db.Text // additional notes for the payment  (e.g., reason for the payment, special instructions, etc...)

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")
    patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

    @@map("payments")
}

enum ExpenseType {
    OPERATIONAL
    SALARY
    RENT
    UTILITIES
    EQUIPMENT
    OTHER
}

model Expense {
    id     String      @id @default(cuid())
    label  String?
    amount Float
    date   DateTime
    type   ExpenseType
    notes  String? // Additional notes or comments about the expense

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    @@map("expenses")
}
